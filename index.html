<!DOCTYPE html>
<html>
<head>
    <title>Simple CRUD App</title>
    <style>
        body { font-family: Arial; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { color: #333; text-align: center; }
        .form-box { background: #f9f9f9; padding: 20px; margin-bottom: 30px; border-radius: 8px; }
        input { width: 100%; padding: 10px; margin: 5px 0 15px 0; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-add { background: #007bff; color: white; }
        .btn-edit { background: #28a745; color: white; }
        .btn-delete { background: #dc3545; color: white; }
        .btn-cancel { background: #6c757d; color: white; }
        .contact { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .contact strong { color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± Simple Contact Manager</h1>
        
        <!-- Add/Edit Form -->
        <div class="form-box">
            <h3 id="formTitle">Add New Contact</h3>
            <form id="contactForm">
                <input type="text" id="name" placeholder="Full Name" required>
                <input type="email" id="email" placeholder="Email Address" required>
                <input type="text" id="phone" placeholder="Phone Number" required>
                <input type="text" id="company" placeholder="Company (optional)">
                
                <button type="submit" class="btn-add" id="submitBtn">Add Contact</button>
                <button type="button" class="btn-cancel" id="cancelBtn" onclick="cancelEdit()" style="display:none">Cancel</button>
            </form>
        </div>
        
        <!-- Contacts List -->
        <div>
            <h3>üìã All Contacts</h3>
            <div id="contactsList">Loading contacts...</div>
        </div>
    </div>

    <script>
        // Simple JavaScript for CRUD operations
        let editingId = null;

        // Load all contacts when page opens
        loadContacts();

        // Form submit handler
        document.getElementById('contactForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const contactData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                company: document.getElementById('company').value
            };

            try {
                if (editingId) {
                    // Update existing contact
                    await fetch(`/api/contacts/${editingId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(contactData)
                    });
                    alert('Contact updated!');
                } else {
                    // Add new contact
                    await fetch('/api/contacts', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(contactData)
                    });
                    alert('Contact added!');
                }
                
                // Reset form and reload contacts
                document.getElementById('contactForm').reset();
                cancelEdit();
                loadContacts();
                
            } catch (error) {
                alert('Error: ' + error.message);
            }
        };

        // Load and display all contacts
        async function loadContacts() {
            try {
                const response = await fetch('/api/contacts');
                const contacts = await response.json();
                
                const contactsList = document.getElementById('contactsList');
                
                if (contacts.length === 0) {
                    contactsList.innerHTML = '<p>No contacts yet. Add your first contact above!</p>';
                    return;
                }
                
                contactsList.innerHTML = contacts.map(contact => `
                    <div class="contact">
                        <strong>${contact.name}</strong><br>
                        üìß ${contact.email}<br>
                        üì± ${contact.phone}<br>
                        üè¢ ${contact.company || 'No company'}<br><br>
                        <button class="btn-edit" onclick="editContact('${contact._id}')">Edit</button>
                        <button class="btn-delete" onclick="deleteContact('${contact._id}')">Delete</button>
                    </div>
                `).join('');
                
            } catch (error) {
                document.getElementById('contactsList').innerHTML = 'Error loading contacts';
            }
        }

        // Edit contact
        async function editContact(id) {
            try {
                const response = await fetch(`/api/contacts`);
                const contacts = await response.json();
                const contact = contacts.find(c => c._id === id);
                
                // Fill form with contact data
                document.getElementById('name').value = contact.name;
                document.getElementById('email').value = contact.email;
                document.getElementById('phone').value = contact.phone;
                document.getElementById('company').value = contact.company || '';
                
                // Change form to edit mode
                editingId = id;
                document.getElementById('formTitle').textContent = 'Edit Contact';
                document.getElementById('submitBtn').textContent = 'Update Contact';
                document.getElementById('submitBtn').className = 'btn-edit';
                document.getElementById('cancelBtn').style.display = 'inline-block';
                
            } catch (error) {
                alert('Error loading contact for editing');
            }
        }

        // Cancel editing
        function cancelEdit() {
            editingId = null;
            document.getElementById('formTitle').textContent = 'Add New Contact';
            document.getElementById('submitBtn').textContent = 'Add Contact';
            document.getElementById('submitBtn').className = 'btn-add';
            document.getElementById('cancelBtn').style.display = 'none';
            document.getElementById('contactForm').reset();
        }

        // Delete contact
        async function deleteContact(id) {
            if (confirm('Are you sure you want to delete this contact?')) {
                try {
                    await fetch(`/api/contacts/${id}`, { method: 'DELETE' });
                    alert('Contact deleted!');
                    loadContacts();
                } catch (error) {
                    alert('Error deleting contact');
                }
            }
        }
    </script>
</body>
</html>